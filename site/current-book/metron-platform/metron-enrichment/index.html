<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-02-23
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170223" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Metron &#x2013; Enrichment</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script type="text/javascript">$( document ).ready( function() { $( '.carousel' ).carousel( { interval: 3500 } ) } );</script>
          
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://metron.incubator.apache.org/" id="bannerLeft">
                                                                                                <img src="../../images/metron-logo.png"  alt="Apache Metron - Incubating" width="148px" height="48px"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://incubator.apache.org/" id="bannerRight">
                                                                                                <img src="../../images/ApacheIncubating_Logo.png"  alt="Apache Incubating" width="192px" height="48px"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.apache.org" class="externalLink" title="Apache">
        Apache</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="http://metron.incubator.apache.org/" class="externalLink" title="Metron-Incubating">
        Metron-Incubating</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../../index.html" title="Documentation">
        Documentation</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Enrichment</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2017-02-23</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 0.3.1</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">User Documentation</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="../../index.html" title="Metron">
          <i class="icon-chevron-down"></i>
        Metron</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../../Upgrading.html" title="Upgrading">
          <i class="none"></i>
        Upgrading</a>
            </li>
                                                                                                                                                      
      <li>
    
                          <a href="../../metron-analytics/index.html" title="Analytics">
          <i class="icon-chevron-right"></i>
        Analytics</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                  
      <li>
    
                          <a href="../../metron-deployment/index.html" title="Deployment">
          <i class="icon-chevron-right"></i>
        Deployment</a>
                  </li>
                      
      <li>
    
                          <a href="../../metron-docker/index.html" title="Docker">
          <i class="none"></i>
        Docker</a>
            </li>
                                                                                                                                                                                                                
      <li>
    
                          <a href="../../metron-platform/index.html" title="Platform">
          <i class="icon-chevron-down"></i>
        Platform</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../../metron-platform/metron-api/index.html" title="Api">
          <i class="none"></i>
        Api</a>
            </li>
                      
      <li>
    
                          <a href="../../metron-platform/metron-common/index.html" title="Common">
          <i class="none"></i>
        Common</a>
            </li>
                      
      <li>
    
                          <a href="../../metron-platform/metron-data-management/index.html" title="Data-management">
          <i class="none"></i>
        Data-management</a>
            </li>
                      
      <li class="active">
    
            <a href="#"><i class="none"></i>Enrichment</a>
          </li>
                      
      <li>
    
                          <a href="../../metron-platform/metron-indexing/index.html" title="Indexing">
          <i class="none"></i>
        Indexing</a>
            </li>
                      
      <li>
    
                          <a href="../../metron-platform/metron-management/index.html" title="Management">
          <i class="none"></i>
        Management</a>
            </li>
                      
      <li>
    
                          <a href="../../metron-platform/metron-parsers/index.html" title="Parsers">
          <i class="none"></i>
        Parsers</a>
            </li>
                      
      <li>
    
                          <a href="../../metron-platform/metron-pcap-backend/index.html" title="Pcap-backend">
          <i class="none"></i>
        Pcap-backend</a>
            </li>
              </ul>
        </li>
                                                                                          
      <li>
    
                          <a href="../../metron-sensors/index.html" title="Sensors">
          <i class="icon-chevron-right"></i>
        Sensors</a>
                  </li>
              </ul>
        </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Enrichment</h1>
<p><a name="Enrichment"></a></p>
<div class="section">
<h2><a name="Introduction"></a>Introduction</h2>
<p>The <tt>enrichment</tt> topology is a topology dedicated to taking the data from the parsing topologies that have been normalized into the Metron data format (e.g. a JSON Map structure with <tt>original_message</tt> and <tt>timestamp</tt>) and </p>

<ul>
  
<li>Enriching messages with external data from data stores (e.g. hbase) by  adding new fields based on existing fields in the messages.</li>
  
<li>Marking messages as threats based on data in external data stores</li>
  
<li>Marking threat alerts with a numeric triage level based on a set of  Stellar rules.</li>
</ul></div>
<div class="section">
<h2><a name="Enrichment_Architecture"></a>Enrichment Architecture</h2>
<p><img src="../../images/enrichment_arch.png" alt="Architecture" /></p></div>
<div class="section">
<h2><a name="Enrichment_Configuration"></a>Enrichment Configuration</h2>
<p>The configuration for the <tt>enrichment</tt> topology, the topology primarily responsible for enrichment and threat intelligence enrichment, is defined by JSON documents stored in zookeeper.</p>
<p>There are two types of configurations at the moment, <tt>global</tt> and <tt>sensor</tt> specific. </p></div>
<div class="section">
<h2><a name="Global_Configuration"></a>Global Configuration</h2>
<p>See the &#x201c;<a href="../metron-common/index.html">Global Configuration</a>&#x201d; section.</p></div>
<div class="section">
<h2><a name="Sensor_Enrichment_Configuration"></a>Sensor Enrichment Configuration</h2>
<p>The sensor specific configuration is intended to configure the individual enrichments and threat intelligence enrichments for a given sensor type (e.g. <tt>snort</tt>).</p>
<p>Just like the global config, the format is a JSON stored in zookeeper. The configuration is a complex JSON object with the following top level fields:</p>

<ul>
  
<li><tt>enrichment</tt> : A complex JSON object representing the configuration of the enrichments</li>
  
<li><tt>threatIntel</tt> : A complex JSON object representing the configuration of the threat intelligence enrichments</li>
</ul>
<div class="section">
<h3><a name="The_enrichment_Configuration"></a>The <tt>enrichment</tt> Configuration</h3>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>Field </th>
      
<th>Description </th>
      
<th>Example </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td><tt>fieldToTypeMap</tt> </td>
      
<td>In the case of a simple HBase enrichment (i.e. a key/value lookup), the mapping between fields and the enrichment types associated with those fields must be known. This enrichment type is used as part of the HBase key. Note: applies to hbaseEnrichment only. </td>
      
<td><tt>&quot;fieldToTypeMap&quot; : { &quot;ip_src_addr&quot; : [ &quot;asset_enrichment&quot; ] }</tt> </td>
    </tr>
    
<tr class="a">
      
<td><tt>fieldMap</tt> </td>
      
<td>The map of enrichment bolts names to configuration handlers which know how to split the message up. The simplest of which is just a list of fields. More complex examples would be the stellar enrichment which provides stellar statements. Each field listed in the array arg is sent to the enrichment referenced in the key. Cardinality of fields to enrichments is many-to-many. </td>
      
<td><tt>&quot;fieldMap&quot;: {&quot;hbaseEnrichment&quot;: [&quot;ip_src_addr&quot;,&quot;ip_dst_addr&quot;]}</tt> </td>
    </tr>
    
<tr class="b">
      
<td><tt>config</tt> </td>
      
<td>The general configuration for the enrichment </td>
      
<td><tt>&quot;config&quot;: {&quot;typeToColumnFamily&quot;: { &quot;asset_enrichment&quot; : &quot;cf&quot; } }</tt> </td>
    </tr>
  </tbody>
</table>
<p>The <tt>config</tt> map is intended to house enrichment specific configuration. For instance, for the <tt>hbaseEnrichment</tt>, the mappings between the enrichment types to the column families is specified.</p>
<p>The <tt>fieldMap</tt>contents are of interest because they contain the routing and configuration information for the enrichments. When we say &#x2018;routing&#x2019;, we mean how the messages get split up and sent to the enrichment adapter bolts. The simplest, by far, is just providing a simple list as in</p>

<div class="source">
<div class="source">
<pre>    &quot;fieldMap&quot;: {
      &quot;geo&quot;: [
        &quot;ip_src_addr&quot;,
        &quot;ip_dst_addr&quot;
      ],
      &quot;host&quot;: [
        &quot;ip_src_addr&quot;,
        &quot;ip_dst_addr&quot;
      ],
      &quot;hbaseEnrichment&quot;: [
        &quot;ip_src_addr&quot;,
        &quot;ip_dst_addr&quot;
      ]
      }
</pre></div></div>
<p>Based on this sample config, both ip_src_addr and ip_dst_addr will go to the <tt>geo</tt>, <tt>host</tt>, and <tt>hbaseEnrichment</tt> adapter bolts. For the <tt>geo</tt>, <tt>host</tt> and <tt>hbaseEnrichment</tt>, this is sufficient. However, more complex enrichments may contain their own configuration. Currently, the <tt>stellar</tt> enrichment requires a more complex configuration, such as:</p>

<div class="source">
<div class="source">
<pre>    &quot;fieldMap&quot;: {
       ...
      &quot;stellar&quot; : {
        &quot;config&quot; : {
          &quot;numeric&quot; : {
                      &quot;foo&quot;: &quot;1 + 1&quot;
                      }
          ,&quot;ALL_CAPS&quot; : &quot;TO_UPPER(source.type)&quot;
        }
      }
    }
</pre></div></div>
<p>Whereas the simpler enrichments just need a set of fields explicitly stated so they can be separated from the message and sent to the enrichment adapter bolt for enrichment and ultimately joined back in the join bolt, the stellar enrichment has its set of required fields implicitly stated through usage. For instance, if your stellar statement references a field, it should be included and if not, then it should not be included. We did not want to require users to make explicit the implicit.</p>
<p>The other way in which the stellar enrichment is somewhat more complex is in how the statements are executed. In the general purpose case for a list of fields, those fields are used to create a message to send to the enrichment adapter bolt and that bolt&#x2019;s worker will handle the fields one by one in serial for a given message. For stellar enrichment, we wanted to have a more complex design so that users could specify the groups of stellar statements sent to the same worker in the same message (and thus executed sequentially). Consider the following configuration:</p>

<div class="source">
<div class="source">
<pre>    &quot;fieldMap&quot;: {
      &quot;stellar&quot; : {
        &quot;config&quot; : {
          &quot;numeric&quot; : {
                      &quot;foo&quot;: &quot;1 + 1&quot;
                      &quot;bar&quot; : TO_LOWER(source.type)&quot;
                      }
         ,&quot;text&quot; : {
                   &quot;ALL_CAPS&quot; : &quot;TO_UPPER(source.type)&quot;
                   }
        }
      }
    }
</pre></div></div>
<p>We have a group called <tt>numeric</tt> whose stellar statements will be executed sequentially. In parallel to that, we have the group of stellar statements under the group <tt>text</tt> executing. The intent here is to allow you to not force higher latency operations to be done sequentially. You can use any name for your groupings you like. Be aware that the configuration is a map and duplicate configuration keys&#x2019; values are not combined, so the duplicate configuration value will be overwritten.</p></div>
<div class="section">
<h3><a name="The_threatIntel_Configuration"></a>The <tt>threatIntel</tt> Configuration</h3>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>Field </th>
      
<th>Description </th>
      
<th>Example </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td><tt>fieldToTypeMap</tt> </td>
      
<td>In the case of a simple HBase threat intel enrichment (i.e. a key/value lookup), the mapping between fields and the enrichment types associated with those fields must be known. This enrichment type is used as part of the HBase key. Note: applies to hbaseThreatIntel only. </td>
      
<td><tt>&quot;fieldToTypeMap&quot; : { &quot;ip_src_addr&quot; : [ &quot;malicious_ips&quot; ] }</tt> </td>
    </tr>
    
<tr class="a">
      
<td><tt>fieldMap</tt> </td>
      
<td>The map of threat intel enrichment bolts names to fields in the JSON messages. Each field is sent to the threat intel enrichment bolt referenced in the key. Each field listed in the array arg is sent to the enrichment referenced in the key. Cardinality of fields to enrichments is many-to-many. </td>
      
<td><tt>&quot;fieldMap&quot;: {&quot;hbaseThreatIntel&quot;: [&quot;ip_src_addr&quot;,&quot;ip_dst_addr&quot;]}</tt> </td>
    </tr>
    
<tr class="b">
      
<td><tt>triageConfig</tt> </td>
      
<td>The configuration of the threat triage scorer. In the situation where a threat is detected, a score is assigned to the message and embedded in the indexed message. </td>
      
<td><tt>&quot;riskLevelRules&quot; : { &quot;IN_SUBNET(ip_dst_addr, '192.168.0.0/24')&quot; : 10 }</tt> </td>
    </tr>
    
<tr class="a">
      
<td><tt>config</tt> </td>
      
<td>The general configuration for the Threat Intel </td>
      
<td><tt>&quot;config&quot;: {&quot;typeToColumnFamily&quot;: { &quot;malicious_ips&quot;,&quot;cf&quot; } }</tt> </td>
    </tr>
  </tbody>
</table>
<p>The <tt>config</tt> map is intended to house threat intel specific configuration. For instance, for the <tt>hbaseThreatIntel</tt> threat intel adapter, the mappings between the enrichment types to the column families is specified.</p>
<p>The <tt>triageConfig</tt> field is also a complex field and it bears some description:</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>Field </th>
      
<th>Description </th>
      
<th>Example </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td><tt>riskLevelRules</tt> </td>
      
<td>This is a list of rules (represented as Stellar expressions) associated with scores with optional names and comments </td>
      
<td>see below</td>
    </tr>
    
<tr class="a">
      
<td><tt>aggregator</tt> </td>
      
<td>An aggregation function that takes all non-zero scores representing the matching queries from <tt>riskLevelRules</tt> and aggregates them into a single score. </td>
      
<td><tt>&quot;MAX&quot;</tt> </td>
    </tr>
  </tbody>
</table>
<p>A risk level rule is of the following format:</p>

<ul>
  
<li><tt>name</tt> : The name of the threat triage rule</li>
  
<li><tt>comment</tt> : A comment describing the rule</li>
  
<li><tt>rule</tt> : The rule, represented as a Stellar statement</li>
  
<li><tt>score</tt> : Associated threat triage score for the rule</li>
</ul>
<p>An example of a rule is as follows:</p>

<div class="source">
<div class="source">
<pre>    &quot;riskLevelRules&quot; : [ 
        { 
          &quot;name&quot; : &quot;is internal&quot;
        , &quot;comment&quot; : &quot;determines if the destination is internal.&quot;
        , rule&quot; : &quot;IN_SUBNET(ip_dst_addr, '192.168.0.0/24')&quot;
        , &quot;score&quot; : 10 
        }
                       ]
</pre></div></div>
<p>The supported aggregation functions are:</p>

<ul>
  
<li><tt>MAX</tt> : The max of all of the associated values for matching queries</li>
  
<li><tt>MIN</tt> : The min of all of the associated values for matching queries</li>
  
<li><tt>MEAN</tt> : The mean of all of the associated values for matching queries</li>
  
<li><tt>POSITIVE_MEAN</tt> : The mean of the positive associated values for the matching queries.</li>
</ul></div>
<div class="section">
<h3><a name="Example_Configuration"></a>Example Configuration</h3>
<p>An example configuration for the YAF sensor is as follows:</p>

<div class="source">
<div class="source">
<pre>{
  &quot;enrichment&quot;: {
    &quot;fieldMap&quot;: {
      &quot;geo&quot;: [
        &quot;ip_src_addr&quot;,
        &quot;ip_dst_addr&quot;
      ],
      &quot;host&quot;: [
        &quot;ip_src_addr&quot;,
        &quot;ip_dst_addr&quot;
      ],
      &quot;hbaseEnrichment&quot;: [
        &quot;ip_src_addr&quot;,
        &quot;ip_dst_addr&quot;
      ]
    }
  ,&quot;fieldToTypeMap&quot;: {
      &quot;ip_src_addr&quot;: [
        &quot;playful_classification&quot;
      ],
      &quot;ip_dst_addr&quot;: [
        &quot;playful_classification&quot;
      ]
    }
  },
  &quot;threatIntel&quot;: {
    &quot;fieldMap&quot;: {
      &quot;hbaseThreatIntel&quot;: [
        &quot;ip_src_addr&quot;,
        &quot;ip_dst_addr&quot;
      ]
    },
    &quot;fieldToTypeMap&quot;: {
      &quot;ip_src_addr&quot;: [
        &quot;malicious_ip&quot;
      ],
      &quot;ip_dst_addr&quot;: [
        &quot;malicious_ip&quot;
      ]
    },
    &quot;triageConfig&quot; : {
      &quot;riskLevelRules&quot; : [ 
        {
          &quot;rule&quot; : &quot;ip_src_addr == '10.0.2.3' or ip_dst_addr == '10.0.2.3'&quot;,
          &quot;score&quot; : 10
        }
      ],
      &quot;aggregator&quot; : &quot;MAX&quot;
    }
  }
}
</pre></div></div>
<p>ThreatIntel alert levels are emitted as a new field &#x201c;threat.triage.level.&#x201d; So for the example above, an incoming message that trips the <tt>ip_src_addr</tt> rule will have a new field threat.triage.level=10.</p>
<p><a name="Example_Enrichment_via_Stellar"></a></p>
<h1>Example Enrichment via Stellar</h1>
<p>Let&#x2019;s walk through doing a simple enrichment using Stellar on your cluster using the Squid topology.</p></div></div>
<div class="section">
<h2><a name="Install_Prerequisites"></a>Install Prerequisites</h2>
<p>Now let&#x2019;s install some prerequisites:</p>

<ul>
  
<li>Squid client via <tt>yum install squid</tt></li>
  
<li>ES Head plugin via <tt>/usr/share/elasticsearch/bin/plugin install mobz/elasticsearch-head</tt></li>
</ul>
<p>Start Squid via <tt>service squid start</tt></p></div>
<div class="section">
<h2><a name="Adjust_Enrichment_Configurations_for_Squid_to_Call_Stellar"></a>Adjust Enrichment Configurations for Squid to Call Stellar</h2>
<p>Let&#x2019;s adjust the configurations for the Squid topology to annotate the messages using some Stellar functions.</p>

<ul>
  
<li>
<p>Edit the squid enrichment configuration at <tt>$METRON_HOME/config/zookeeper/enrichments/squid.json</tt> (this file will not exist, so create a new one) to add some new fields based on stellar queries:</p>
  
<div class="source">
<div class="source">
<pre>{
  &quot;enrichment&quot; : {
&quot;fieldMap&quot;: {
  &quot;stellar&quot; : {
    &quot;config&quot; : {
      &quot;numeric&quot; : {
                  &quot;foo&quot;: &quot;1 + 1&quot;
                  }
      ,&quot;ALL_CAPS&quot; : &quot;TO_UPPER(source.type)&quot;
    }
  }
 }
  },
  &quot;threatIntel&quot; : {
&quot;fieldMap&quot;:{
 &quot;stellar&quot; : {
    &quot;config&quot; : {
      &quot;bar&quot; : &quot;TO_UPPER(source.type)&quot;
    }
  } 
},
&quot;triageConfig&quot; : {
}
  }
}
</pre></div></div>
<p>We have added the following fields as part of the enrichment phase of the enrichment topology:</p></li>
  
<li>
<p><tt>foo</tt> == 2</p></li>
  
<li><tt>ALL_CAPS</tt> == SQUID</li>
</ul>
<p>We have added the following as part of the threat intel:</p>

<ul>
  
<li><tt>bar</tt> == SQUID</li>
</ul>
<p>Please note that foo and ALL_CAPS will be applied in separate workers due to them being in separate groups.</p>

<ul>
  
<li>Upload new configs via <tt>$METRON_HOME/bin/zk_load_configs.sh --mode PUSH -i $METRON_HOME/config/zookeeper -z node1:2181</tt></li>
  
<li>Make the Squid topic in kafka via <tt>/usr/hdp/current/kafka-broker/bin/kafka-topics.sh --zookeeper node1:2181 --create --topic squid --partitions 1 --replication-factor 1</tt></li>
</ul></div>
<div class="section">
<h2><a name="Start_Topologies_and_Send_Data"></a>Start Topologies and Send Data</h2>
<p>Now we need to start the topologies and send some data:</p>

<ul>
  
<li>Start the squid topology via <tt>$METRON_HOME/bin/start_parser_topology.sh -k node1:6667 -z node1:2181 -s squid</tt></li>
  
<li>Generate some data via the squid client:
  
<ul>
    
<li><tt>squidclient http://yahoo.com</tt></li>
    
<li><tt>squidclient http://cnn.com</tt></li>
  </ul></li>
  
<li>Send the data to kafka via <tt>cat /var/log/squid/access.log | /usr/hdp/current/kafka-broker/bin/kafka-console-producer.sh --broker-list node1:6667 --topic squid</tt></li>
  
<li>Browse the data in elasticsearch via the ES Head plugin @ <a class="externalLink" href="http://node1:9200/_plugin/head/">http://node1:9200/_plugin/head/</a> and verify that in the squid index you have two documents</li>
  
<li>Ensure that the documents have new fields <tt>foo</tt>, <tt>bar</tt> and <tt>ALL_CAPS</tt> with values as described above.</li>
</ul>
<p>Note that we could have used any Stellar statements here, including calling out to HBase via <tt>ENRICHMENT_GET</tt> and <tt>ENRICHMENT_EXISTS</tt> or even calling a machine learning model via <a href="../../metron-analytics/metron-maas-service/index.html">Model as a Service</a>.</p>
<p><a name="Notes_on_Performance_Tuning"></a></p>
<h1>Notes on Performance Tuning</h1>
<p>Default installed Metron is untuned for production deployment. There are a few knobs to tune to get the most out of your system.</p></div>
<div class="section">
<h2><a name="Kafka_Queue"></a>Kafka Queue</h2>
<p>The <tt>enrichments</tt> kafka queue is a collection point from all of the parser topologies. As such, make sure that the number of partitions in the kafka topic is sufficient to handle the throughput that you expect from your parser topologies.</p></div>
<div class="section">
<h2><a name="Enrichment_Topology"></a>Enrichment Topology</h2>
<p>The enrichment topology as started by the <tt>$METRON_HOME/bin/start_enrichment_topology.sh</tt> script uses a default of one executor per bolt. In a real production system, this should be customized by modifying the flux file in <tt>$METRON_HOME/flux/enrichment/remote.yaml</tt>. </p>

<ul>
  
<li>Add a <tt>parallelism</tt> field to the bolts to give Storm a parallelism hint for the various components. Give bolts which appear to be bottlenecks (e.g. stellar enrichment bolt, hbase enrichment and threat intel bolts) a larger hint.</li>
  
<li>Add a <tt>parallelism</tt> field to the kafka spout which matches the number of partitions for the enrichment kafka queue.</li>
  
<li>Adjust the number of workers for the topology by adjusting the  <tt>topology.workers</tt> field for the topology.</li>
</ul>
<p>Finally, if workers and executors are new to you or you don&#x2019;t know where to modify the flux file, the following might be of use to you:</p>

<ul>
  
<li><a class="externalLink" href="http://www.michael-noll.com/blog/2012/10/16/understanding-the-parallelism-of-a-storm-topology/">Understanding the Parallelism of a Storm Topology</a></li>
  
<li><a class="externalLink" href="http://storm.apache.org/releases/current/flux.html">Flux Docs</a></li>
</ul></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2017.
          All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>
