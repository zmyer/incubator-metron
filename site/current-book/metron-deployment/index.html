<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-02-23
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170223" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Metron &#x2013; Overview</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script type="text/javascript">$( document ).ready( function() { $( '.carousel' ).carousel( { interval: 3500 } ) } );</script>
          
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://metron.incubator.apache.org/" id="bannerLeft">
                                                                                                <img src="../images/metron-logo.png"  alt="Apache Metron - Incubating" width="148px" height="48px"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://incubator.apache.org/" id="bannerRight">
                                                                                                <img src="../images/ApacheIncubating_Logo.png"  alt="Apache Incubating" width="192px" height="48px"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.apache.org" class="externalLink" title="Apache">
        Apache</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="http://metron.incubator.apache.org/" class="externalLink" title="Metron-Incubating">
        Metron-Incubating</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../index.html" title="Documentation">
        Documentation</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Overview</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2017-02-23</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 0.3.1</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">User Documentation</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="../index.html" title="Metron">
          <i class="icon-chevron-down"></i>
        Metron</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../Upgrading.html" title="Upgrading">
          <i class="none"></i>
        Upgrading</a>
            </li>
                                                                                                                                                      
      <li>
    
                          <a href="../metron-analytics/index.html" title="Analytics">
          <i class="icon-chevron-right"></i>
        Analytics</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                      
      <li class="active">
    
            <a href="#"><i class="icon-chevron-down"></i>Deployment</a>
                  <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../metron-deployment/amazon-ec2/index.html" title="Amazon-ec2">
          <i class="none"></i>
        Amazon-ec2</a>
            </li>
                      
      <li>
    
                          <a href="../metron-deployment/packaging/docker/ansible-docker/index.html" title="Ansible-docker">
          <i class="none"></i>
        Ansible-docker</a>
            </li>
                      
      <li>
    
                          <a href="../metron-deployment/packaging/docker/rpm-docker/index.html" title="Rpm-docker">
          <i class="none"></i>
        Rpm-docker</a>
            </li>
                      
      <li>
    
                          <a href="../metron-deployment/packer-build/index.html" title="Packer-build">
          <i class="none"></i>
        Packer-build</a>
            </li>
                                                                                                                                                                  
      <li>
    
                          <a href="../metron-deployment/roles/index.html" title="Roles">
          <i class="icon-chevron-right"></i>
        Roles</a>
                  </li>
                                                                                                                              
      <li>
    
                          <a href="../metron-deployment/vagrant/index.html" title="Vagrant">
          <i class="icon-chevron-right"></i>
        Vagrant</a>
                  </li>
              </ul>
        </li>
                      
      <li>
    
                          <a href="../metron-docker/index.html" title="Docker">
          <i class="none"></i>
        Docker</a>
            </li>
                                                                                                                                                                                                      
      <li>
    
                          <a href="../metron-platform/index.html" title="Platform">
          <i class="icon-chevron-right"></i>
        Platform</a>
                  </li>
                                                                                          
      <li>
    
                          <a href="../metron-sensors/index.html" title="Sensors">
          <i class="icon-chevron-right"></i>
        Sensors</a>
                  </li>
              </ul>
        </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Overview</h1>
<p><a name="Overview"></a></p>
<p>This set of playbooks can be used to deploy an Ambari-managed Hadoop cluster, Metron services, or both using ansible playbooks. These playbooks currently only target RHEL/CentOS 6.x operating systems.</p>
<p>In addition, an Ambari Management Pack can be built which can be deployed in conjuction with RPMs detailed in this README.</p>
<div class="section">
<h2><a name="Prerequisites"></a>Prerequisites</h2>
<p>The following tools are required to run these scripts:</p>

<ul>
  
<li><a class="externalLink" href="https://maven.apache.org/">Maven</a></li>
  
<li><a class="externalLink" href="https://git-scm.com/">Git</a></li>
  
<li><a class="externalLink" href="http://www.ansible.com/">Ansible</a> (version 2.0 or greater)</li>
</ul>
<p>Currently Metron must be built from source. Before running these scripts perform the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Clone the Metron git repository with <tt>git clone git@github.com:apache/incubator-metron.git</tt></li>
  
<li>Navigate to <tt>incubator-metron</tt> and run <tt>mvn clean package</tt></li>
</ol>
<p>These scripts depend on two files for configuration:</p>

<ul>
  
<li>hosts - declares which Ansible roles will be run on which hosts</li>
  
<li>group_vars/all - various configuration settings needed to install Metron</li>
</ul>
<p>Examples can be found in the <tt>incubator-metron/metron-deployment/inventory/metron_example</tt> directory and are a good starting point. Copy this directory into <tt>incubator-metron/metron-deployment/inventory/</tt> and rename it to your <tt>project_name</tt>. More information about Ansible files and directory structure can be found at <a class="externalLink" href="http://docs.ansible.com/ansible/playbooks_best_practices.html">http://docs.ansible.com/ansible/playbooks_best_practices.html</a>.</p></div>
<div class="section">
<h2><a name="Ambari"></a>Ambari</h2>
<p>The Ambari playbook will install a Hadoop cluster with all the services and configuration required by Metron. This section can be skipped if installing Metron on a pre-existing cluster.</p>
<p>Currently, this playbook supports building a local development cluster running on one node but options for other types  of clusters will be added in the future.</p>
<div class="section">
<h3><a name="Setting_up_your_inventory"></a>Setting up your inventory</h3>
<p>Make sure to update the hosts file in <tt>incubator-metron/metron-deployment/inventory/project_name/hosts</tt> or provide an alternate inventory file when you launch the playbooks, including the ssh user(s) and ssh keyfile location(s). These playbooks expect two host groups:</p>

<ul>
  
<li>ambari_master</li>
  
<li>ambari_slaves</li>
</ul></div>
<div class="section">
<h3><a name="Running_the_playbook"></a>Running the playbook</h3>
<p>This playbook will install the Ambari server on the ambari_master, install the ambari agents on the ambari_slaves, and create a cluster in Ambari with a blueprint for the required Metron components.</p>
<p>Navigate to <tt>incubator-metron/metron-deployment/playbooks</tt> and run: <tt>ansible-playbook -i ../inventory/project_name ambari_install.yml</tt></p></div></div>
<div class="section">
<h2><a name="Metron"></a>Metron</h2>
<p>The Metron playbook will gather the necessary cluster settings from Ambari and install the Metron services.</p>
<div class="section">
<h3><a name="Setting_up_your_inventory"></a>Setting up your inventory</h3>
<p>Edit the hosts file at <tt>incubator-metron/metron-deployment/inventory/project_name/hosts</tt>. Declare where which hosts the Metron services will be installed on by updating these groups:</p>

<ul>
  
<li>enrichment - submits the topology code to Storm and requires a storm client</li>
  
<li>search - host where Elasticsearch will be run</li>
  
<li>web - host where the Metron UI and underlying services will run</li>
  
<li>sensors - host where network data will be collected and published to Kafka</li>
</ul>
<p>The Metron topologies depend on Kafka topics and HBase tables being created beforehand. Declare a host that has Kafka and HBase clients installed by updating these groups:</p>

<ul>
  
<li>metron_kafka_topics</li>
  
<li>metron_hbase_tables</li>
</ul>
<p>If only installing Metron, these groups can be ignored:</p>

<ul>
  
<li>ambari_master</li>
  
<li>ambari_slaves</li>
</ul></div>
<div class="section">
<h3><a name="Configuring_group_variables"></a>Configuring group variables</h3>
<p>The Metron Ansible scripts depend on a set of variables. These variables can be found in the file at <tt>incubator-metron/metron-deployment/inventory/project_name/group_vars/all</tt>. Edit the ambari* variables to match your Ambari instance and update the java_home variable to match the java path on your hosts.</p></div>
<div class="section">
<h3><a name="Running_the_playbook"></a>Running the playbook</h3>
<p>Navigate to <tt>incubator-metron/metron-deployment/playbooks</tt> and run: <tt>ansible-playbook -i ../inventory/project_name metron_install.yml</tt></p></div></div>
<div class="section">
<h2><a name="Vagrant"></a>Vagrant</h2>
<p>A VagrantFile is included and will install a working version of the entire Metron stack. The following is required to run this:</p>

<ul>
  
<li><a class="externalLink" href="https://www.vagrantup.com/">Vagrant</a></li>
  
<li>Hostmanager plugin for vagrant - Run <tt>vagrant plugin install vagrant-hostmanager</tt> on the machine where Vagrant is installed</li>
</ul>
<p>Navigate to <tt>incubator-metron/metron-deployment/vagrant/full-dev-platform</tt> and run <tt>vagrant up</tt>. This also provides a good example of how to run a full end-to-end Metron install.</p></div>
<div class="section">
<h2><a name="Ambari_Management_Pack"></a>Ambari Management Pack</h2>
<p>An Ambari Management Pack can be built in order to make the Metron service available on top of an existing stack, rather than needing a direct stack update.</p>
<p>This will set up</p>

<ul>
  
<li>Metron Parsers</li>
  
<li>Enrichment</li>
  
<li>Indexing</li>
  
<li>GeoIP data</li>
  
<li>Optional Elasticsearch</li>
  
<li>Optional Kibana</li>
</ul>
<div class="section">
<h3><a name="Prerequisites"></a>Prerequisites</h3>

<ul>
  
<li>A cluster managed by Ambari 2.4</li>
  
<li>Metron RPMs available on the cluster in the /localrepo directory. See <a href="#RPM">RPM</a> for further information.</li>
</ul></div>
<div class="section">
<h3><a name="Building_Management_Pack"></a>Building Management Pack</h3>
<p>From <tt>metron-deployment</tt> run</p>

<div class="source">
<div class="source">
<pre>mvn clean package
</pre></div></div>
<p>A tar.gz that can be used with Ambari can be found at <tt>metron-deployment/packaging/ambari/metron-mpack/target/</tt></p></div>
<div class="section">
<h3><a name="Installing_Management_Pack"></a>Installing Management Pack</h3>
<p>Before installing the mpack, update Storm&#x2019;s topology.classpath in Ambari to include &#x2018;/etc/hbase/conf:/etc/hadoop/conf&#x2019;. Restart Storm service.</p>
<p>Place the mpack&#x2019;s tar.gz onto the node running Ambari Server. From the command line on this node, run</p>

<div class="source">
<div class="source">
<pre>ambari-server install-mpack --mpack=&lt;mpack_location&gt; --verbose
</pre></div></div>
<p>This will make the services available in Ambari in the same manner as any services in a stack, e.g. through Add Services or during cluster install. The Indexing / Parsers/ Enrichment masters should be colocated with a Kafka Broker (to create topics) and HBase client (to create the enrichment and theatintel tables). This colocation is currently not enforced by Ambari, and should be managed by either a Service or Stack advisor as an enhancement.</p>
<p>Several configuration parameters will need to be filled in, and should be pretty self explanatory (primarily a couple of Elasticsearch configs, and the Storm REST URL). Examples are provided in the descriptions on Ambari. Notably, the URL for the GeoIP database that is preloaded (and is prefilled by default) can be set to use a <tt>file:///</tt> location</p>
<p>After installation, a custom action is available in Ambari (where stop / start services are) to install Elasticsearch templates. Similar to this, a custom Kibana action to Load Template is available.</p>
<p>Another custom action is available in Ambari to import Zeppelin dashboards. See the <a href="../metron-platform/metron-indexing/index.html">metron-indexing documentation</a></p>
<div class="section">
<h4><a name="Offline_installation"></a>Offline installation</h4>
<p>Currently there is only one point that would reach out to the internet during an install. This is the URL for the GeoIP database information.</p>
<p>The RPMs DO NOT reach out to the internet (because there is currently no hosting for them). They look on the local filesystem in <tt>/localrepo</tt>.</p></div></div>
<div class="section">
<h3><a name="Current_Limitations"></a>Current Limitations</h3>
<p>There are a set of limitations that should be addressed based to improve the current state of the mpacks.</p>

<ul>
  
<li>There is currently no hosting for RPMs remotely. They will have to be built locally.</li>
  
<li>Colocation of appropriate services should be enforced by Ambari. See [#Installing Management Pack] for more details.</li>
  
<li>Storm&#x2019;s topology.classpath is not updated with the Metron service install and needs to be updated separately.</li>
  
<li>Several configuration parameters used when installing the Metron service could (and should) be grabbed from Ambari. Install will require them to be manually entered.</li>
  
<li>Need to handle upgrading Metron</li>
</ul></div></div>
<div class="section">
<h2><a name="RPM"></a>RPM</h2>
<p>RPMs can be built to install the components in metron-platform. These RPMs are built in a Docker container and placed into <tt>target</tt>.</p>
<p>Components in the RPMs:</p>

<ul>
  
<li>metron-common</li>
  
<li>metron-data-management</li>
  
<li>metron-elasticsearch</li>
  
<li>metron-enrichment</li>
  
<li>metron-parsers</li>
  
<li>metron-pcap</li>
  
<li>metron-solr</li>
</ul>
<div class="section">
<h3><a name="Prerequisites"></a>Prerequisites</h3>

<ul>
  
<li>Docker. The image detailed in: <tt>metron-deployment/packaging/docker/rpm-docker/README.md</tt> will automatically be built (or rebuilt if necessary).</li>
  
<li>Artifacts for metron-platform have been produced. E.g. <tt>mvn clean package -DskipTests</tt> in <tt>metron-platform</tt></li>
</ul></div>
<div class="section">
<h3><a name="Building_RPMs"></a>Building RPMs</h3>
<p>From <tt>metron-deployment</tt> run</p>

<div class="source">
<div class="source">
<pre>mvn clean package -Pbuild-rpms
</pre></div></div>
<p>The output RPM files will land in <tt>target/RPMS/noarch</tt>. They can be installed with the standard</p>

<div class="source">
<div class="source">
<pre>rpm -i &lt;package&gt;
</pre></div></div></div></div>
<div class="section">
<h2><a name="TODO"></a>TODO</h2>

<ul>
  
<li>Support Ubuntu deployments</li>
</ul></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2017.
          All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>
